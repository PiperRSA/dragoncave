http:
  middlewares:
    lan-ipwhitelist:
      ipWhiteList:
        sourceRange:
          - 192.168.68.0/24
    traefik-auth:
      basicAuth:
        usersFile: /run/secrets/traefik_basicauth
    traefik-redir:
      redirectRegex:
        regex: "^https?://([^/]+)/?$"
        replacement: "https://${1}/dashboard/"
        permanent: true

  routers:
    traefik-api:
      rule: "Host(`traefik.hexwyrm.com`) && PathPrefix(`/api`)"
      entryPoints: ["websecure"]
      middlewares: ["lan-ipwhitelist","traefik-auth"]
      service: "api@internal"
      tls:
        certResolver: "cloudflare"

    traefik-root:
      rule: "Host(`traefik.hexwyrm.com`) && Path(`/`)"
      entryPoints: ["websecure"]
      middlewares: ["lan-ipwhitelist","traefik-auth","traefik-redir"]
      service: "noop@internal"
      tls:
        certResolver: "cloudflare"

    traefik-ui:
      rule: "Host(`traefik.hexwyrm.com`) && PathPrefix(`/dashboard`)"
      entryPoints: ["websecure"]
      middlewares: ["lan-ipwhitelist","traefik-auth"]
      service: "dashboard@internal"
      tls:
        certResolver: "cloudflare"
